<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Docs</title>
</head>
<body>
<canvas></canvas>

<script type="module">
  import { WebGLRenderer } from '../src'

  const gl = new WebGLRenderer(document.querySelector('canvas'))

  const program = gl.createProgram({
    vert: `precision mediump float;
attribute vec2 position;
attribute vec2 uv;
varying vec2 vUv;
void main() {
  gl_Position = vec4(position, 0, 1);
  vUv = uv;
}`,
    frag: `precision mediump float;
uniform sampler2D sampler;
varying vec2 vUv;
void main() {
  gl_FragColor = texture2D(sampler, vUv);
}`,
  })

  const texture = gl.createTexture({
    index: 0,
    target: 'texture_2d',
    source: new ImageData(1, 1, new Uint8ClampedArray(4)),
    filterMode: 'linear',
    wrapMode: 'repeat',
  })

  const image = new Image()
  image.src = '/example.jpg'
  image.onload = () => {
    gl.updateTexture({ source: image })
    gl.clear()
    gl.draw()
  }

  const buffer = gl.createBuffer({
    target: 'array_buffer',
    data: new Float32Array([
      // position uv
      -1, -1, 0, 0,
      +1, -1, 1, 0,
      -1, +1, 0, 1,
      +1, +1, 1, 1,
    ]),
    usage: 'static_draw',
  })

  const indexBuffer = gl.createBuffer({
    target: 'element_array_buffer',
    data: new Uint16Array([
      0, 1, 2,
      1, 3, 2,
    ]),
    usage: 'static_draw',
  })

  const vertexArrayProps = {
    attributes: {
      position: { buffer, size: 2, normalized: false, type: 'float' },
      uv: { buffer, size: 2, normalized: false, type: 'float' },
      // color: { buffer, size: 4, normalized: true, type: 'unsigned_byte' },
      // textureId: { buffer, size: 1, normalized: true, type: 'float' },
    },
    indexBuffer,
  }

  gl.activeProgram(program)
  const vertexArray = gl.createVertexArray(vertexArrayProps)

  gl.activeProgram(program)
  gl.activeTexture(texture)
  gl.activeVertexArray(vertexArray ?? vertexArrayProps)

  gl.updateUniforms({
    sampler: 0,
  })

  gl.draw()

  // eslint-disable-next-line no-console
  console.log(gl)
</script>
</body>
</html>
